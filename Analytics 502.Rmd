---
title: "Analytics 502"
author: "Avik Roy"
date: "September 30, 2018"
output:
  word_document: default
  pdf_document: default
  html_document: default
classoption: landscape
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,tidy.opts=list(width.cutoff=30),tidy=TRUE)
```

## Abstract
Right now the goal is to get a good understanding of the data. AKA exploratory analysis.
Relationships worth checking out:
*Arr Delay ~ Day of the week*
It seems arrival delay is related to day of the week.

Hypothesis Test
H0 : Mean arrival delay on Sat-Evening <= 0
H1 : Mean arival delay on Sat-Evening > 0

There should be a section to check t-test assumptions (n>30, etc, etc)

Net Delay ~ Month
Dep Delay ~ Dep Airport
Arr Delay ~ Arr Airport
Net Delay ~ Airline


Prediction query: What is the chance that a flight will be delayed given.......

####Basic setup code

```{r setup2}
library(tidyverse)
set.seed(111)
```

####Checking out the data

```{r check}
flightData <- read.csv("flights.csv", header = TRUE)
head(flightData)
str(flightData)
summary(flightData)
```

####Modifying the dataset

```{r modify}
flightData <- mutate(flightData, DAY_OF_WEEK = as.factor(DAY_OF_WEEK))
flightData$DAY_OF_WEEK <- ordered(flightData$DAY_OF_WEEK, levels = c("1","2","3","4","5","6","7"))
levels(flightData$DAY_OF_WEEK) <- c("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday")
```

####Additional modification
Modifying the dataset convert integer time to HH:MM format time
```{r}
flightData <- mutate(flightData, SCHEDULED_DEPARTURE = format(strptime(sprintf("%04d",SCHEDULED_DEPARTURE), format="%H%M"), format = "%H:%M"))
flightData <- mutate(flightData, DEPARTURE_TIME = format(strptime(sprintf("%04d",DEPARTURE_TIME), format="%H%M"), format = "%H:%M"))
```

Modifying the dataset to have, a column for morning to night clasification for _scheduled_ departure time
```{r}
flightData <- mutate(flightData, DEP_TIME_OF_DAY = 
                       ifelse (SCHEDULED_DEPARTURE >= "18:00","Evening",
                       ifelse (SCHEDULED_DEPARTURE >= "12:00","Afternoon",
                       ifelse (SCHEDULED_DEPARTURE >= "06:00","Morning","Night")))
                    )
```

Ordering the factors in Time of day
```{r}
flightData <- mutate(flightData, DEP_TIME_OF_DAY = as.factor(DEP_TIME_OF_DAY))
flightData$DEP_TIME_OF_DAY <- ordered(flightData$DEP_TIME_OF_DAY, levels = c("Morning","Afternoon", "Evening","Night"))
```

Plot of arrival delay vs Day of the week + Time of the day
```{r}
groupByDayTime <- group_by(select(flightData, DAY_OF_WEEK, DEP_TIME_OF_DAY, ARRIVAL_DELAY),DAY_OF_WEEK,DEP_TIME_OF_DAY)
groupByDayTime <- groupByDayTime[complete.cases(groupByDayTime),]
delayByDayTime <- summarise(groupByDayTime, AVG_ARR_DELAY = mean(ARRIVAL_DELAY))
ggplot(data = delayByDayTime, aes(x = DEP_TIME_OF_DAY, y = AVG_ARR_DELAY, fill = DAY_OF_WEEK)) + geom_bar(stat = "identity") + guides(fill = FALSE) + facet_wrap(vars(DAY_OF_WEEK),nrow = 1) + theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

####Hypothesis Test
H0 : Mean arrival delay on Sat-Evening <= 0
H1 : Mean arival delay on Sat-Evening > 0

Putting saturday arrival delays in  a vector and then running the above hypothesis tests
```{r hypotest1}
arrdelaySat <- filter(flightData, DAY_OF_WEEK == "Saturday", DEP_TIME_OF_DAY == "Evening")$ARRIVAL_DELAY
summary(arrdelaySat)
test_res <- t.test(arrdelaySat, mu = 0, alternative = "greater")
test_res
```

###APPENDIX
Plot of arrival delay vs Day of the week

```{r}
groupByDay <- group_by(select(flightData, DAY_OF_WEEK, ARRIVAL_DELAY),DAY_OF_WEEK)
groupByDay <- groupByDay[complete.cases(groupByDay),]
delayByDay <- summarise(groupByDay, AVG_ARR_DELAY = mean(ARRIVAL_DELAY))
ggplot(data = delayByDay, aes(x = DAY_OF_WEEK, y = AVG_ARR_DELAY, fill = DAY_OF_WEEK)) + geom_bar(stat = "identity") + guides(fill = FALSE)
```

####Hypothesis Test
H0 : Mean arrival delay on Sat <= 0
H1 : Mean arival delay > 0

Putting saturday arrival delays in  a vector and then running the above hypothesis tests
```{r hypotest2}
arrdelaySat <- filter(flightData, DAY_OF_WEEK == "Saturday")$ARRIVAL_DELAY
summary(arrdelaySat)
test_res <- t.test(arrdelaySat, mu = 0, alternative = "greater")
test_res
```
